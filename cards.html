<html>

<canvas id="gameCanvas" width="600" height="400"></canvas>
<button type="button" onclick="dealCard()">Hit Me!</button>
<script>
    var canvas;
    var canvasContext;

    var deck = [];
    var clubs = [{}];
    var hearts = [{}];
    var spades = [{}];
    var diamonds = [{}];


    var playerScore = 0;
    var dealerScore = 0;
    const WIN_SCORE = 21;

    var showWinScreen = false;


    var populateDeck = function (name, suit) {
        for (i = 0; i <= 10; i++) { //  populate the deck
            if (i == 0) {
                name[i] = { value: 'A', suit: suit };
                i++;
            }
            else {
                name[i - 1] = { value: i, suit: suit };
            }



        }
        name[10] = { value: 'J', suit: suit };
        name[11] = { value: 'Q', suit: suit };
        name[12] = { value: 'K', suit: suit };
        console.log("Deck populated with " + suit);
    }

    var shuffleDeck = function (a) { //function to shuffle the deck (NOT WORKING CORRECTLY)
        let newDeck = [];

        for (i = 0; i < a.length; i++) {
            var randNum = Math.floor((Math.random() * a.length));

            if (newDeck.includes(a[randNum])) {
                i--; //because we didn't add anything to the newDeck we don't want to increment
            }

            else if (newDeck.includes(a[randNum]) == false) { // if the new deck doesn't contain the card
                newDeck.push(a[randNum]); // choose a random index 

            }


        }
        return newDeck;
        console.log("Deck shuffled")
    }






    //Setting up the suits
    populateDeck(clubs, 'clubs');
    populateDeck(hearts, 'hearts');
    populateDeck(diamonds, 'diamonds');
    populateDeck(spades, 'spades');
    deck = deck.concat(clubs, hearts, diamonds, spades);
    //console.log(shuffleDeck(deck));


    deck = shuffleDeck(deck);
    console.log(deck);

    var playerHand = [];
    var dealerHand = [];

    var dealCard = function () {
        playerHand.push(deck.pop());
        console.log(playerHand);
    }

    var calculateScore = function (hand) {
        var score; 
        for (i in hand) {
            if (i == 'K', 'J', 'Q') {
                score +=10;
            }
            else{
                score += hand.value;
            }

        }
    }


    //EVERYTHING BELOW BORROWED FROM pong.html (needs fixing)


    window.onload = function () {
        console.log("window loaded");
        canvas = document.getElementById('gameCanvas');
        canvasContext = canvas.getContext('2d');

        var fPS = 30; //frames per second
        setInterval(function () { drawEverything(); }, 1000 / fPS);

        canvas.addEventListener('mousedown', handleMouseClick);

        canvas.addEventListener('mousemove', function (evt) {
            var mousePos = calcMousePos(evt);
            //pad1Y = mousePos.y-(PADDLE_HEIGHT/2);
        });

    }

    function drawEverything() {

        //canvasContext.fillStyle = 'black';
        colourRect(0, 0, canvas.width, canvas.height, 'black'); //creates black background

        //colourRect(20, 20, 50, 80, 'red');
        //colourRect(25, 25, 40, 70, 'blue');//draw card
        for (i = 20; i < 20 + 520; i += 10) { // draw 52 cards
            drawCard(i, 20);
        }

        drawHand(100);

    }

    function drawCard(cardX, cardY) {
        colourRect(cardX, cardY, 50, 80, 'red');
        colourRect(cardX + 5, cardY + 5, 40, 70, 'blue')


        canvasContext.fillStyle = 'yellow';
        canvasContext.fillText(deck[5].value, cardX, cardY + 50);
    }

    function drawHand(cardX) { // for drawing the players hand
        drawCard(cardX, 200);
        drawCard(cardX + 60, 200); //Future PSUEDO: For each card in hand, draw them 60px apart
        drawCard(cardX + 120, 200);

    }

    function calcMousePos(evt) { //function for finding the cursor position
        var rect = canvas.getBoundingClientRect();
        var root = document.documentElement;
        var mouseX = evt.clientX - rect.left - root.scrollLeft;
        var mouseY = evt.clientY - rect.top - root.scrollTop;
        return {
            x: mouseX,
            y: mouseY
        };
    }

    function handleMouseClick(evt) {
        if (showWinScreen) {
            showWinScreen = false;
        }
    }



    function colourRect(leftX, topY, width, height, drawColour) { //funciton for drawing rectangles
        canvasContext.fillStyle = drawColour;
        canvasContext.fillRect(leftX, topY, width, height);
    }


</script>

</html>